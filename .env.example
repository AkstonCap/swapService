# USDC ↔ USDD Bidirectional Swap Service – example environment
# Copy this file to .env and edit the values for your setup.

# --- Solana (Required) ---
SOLANA_RPC_URL=https://api.mainnet-beta.solana.com
# Path to the vault keypair (JSON array of ints)
VAULT_KEYPAIR=./vault-keypair.json
# Vault USDC token account (SPL token account/ATA), NOT a wallet owner
VAULT_USDC_ACCOUNT=<YOUR_VAULT_USDC_TOKEN_ACCOUNT_ADDRESS>
# Mainnet USDC mint (change if using Devnet)
USDC_MINT=EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v
# Devnet USDC mint: 4zMMC9srt5Ri5X14GAgXhaHii3GnPAEERYPJgZJDncDU

# --- Decimals (Optional) ---
USDC_DECIMALS=6
USDD_DECIMALS=6

# --- Nexus (Required + Optional) ---
# Path to Nexus CLI (Linux/macOS: chmod +x ./nexus)
NEXUS_CLI_PATH=./nexus
# SESSION for your Nexus login (required for Nexus api's if your node is set up for multisession)
NEXUS_SESSION=<YOUR_NEXUS_SESSION>
# PIN for your Nexus account
NEXUS_PIN=<YOUR_NEXUS_PIN>
# USDD treasury account (token treasury) used by the service (receives USDD when minting)
NEXUS_USDD_TREASURY_ACCOUNT=<YOUR_USDD_TREASURY_ACCOUNT_ADDRESS>
# Local USDD account owned by you for tiny USDD deposits
NEXUS_USDD_LOCAL_ACCOUNT=<YOUR_LOCAL_USDD_ACCOUNT_ADDRESS>
# USDD fees account: receives USDD minted during periodic reconcile to maintain 1:1 backing
NEXUS_USDD_FEES_ACCOUNT=<YOUR_USDD_FEES_ACCOUNT_ADDRESS>
# Expected token ticker for validation
NEXUS_TOKEN_NAME=USDD
# RPC host if applicable
NEXUS_RPC_HOST=http://127.0.0.1:8399

# --- Polling & State (Optional) ---
POLL_INTERVAL=15
PROCESSED_SIG_FILE=processed_sigs.json
PROCESSED_NEXUS_FILE=processed_nexus_txs.json
ATTEMPT_STATE_FILE=attempt_state.json
MAX_ACTION_ATTEMPTS=3
ACTION_RETRY_COOLDOWN_SEC=300

# --- Fees & policy ---
# Flat fee for USDC→USDD (taken even if refund is required)
FLAT_FEE_USDC=0.1
# Threshold for tiny USDD deposits; tiny USDD goes to NEXUS_USDD_LOCAL_ACCOUNT
FLAT_FEE_USDD=0.1
# Dynamic fee (bps) on successful USDC→USDD swaps (0.1% = 10 bps)
FEE_BPS_USDC_TO_USDD=10
# No dynamic fee on USDD→USDC by default
FEE_BPS_USDD_TO_USDC=0

# --- Fee processing / maintenance ---
# Enable DEX SOL top-ups and backing checks
FEE_CONVERSION_ENABLED=true
# Minimum USDC base units before attempting conversions (e.g., 100000 = 0.1 USDC when USDC_DECIMALS=6)
FEE_CONVERSION_MIN_USDC=100000
# SOL lamports thresholds (min to trigger buy; target to top up to)
SOL_TOPUP_MIN_LAMPORTS=5000000
SOL_TOPUP_TARGET_LAMPORTS=10000000
# Backing safety thresholds
BACKING_DEFICIT_BPS_ALERT=10
BACKING_DEFICIT_PAUSE_PCT=90
# Periodic reconcile: mint USDD to fees account to bring backing to 1:1
BACKING_RECONCILE_INTERVAL_SEC=3600

# --- Optional on-chain heartbeat ---
HEARTBEAT_ENABLED=true
# If you created a heartbeat asset, set its address here; leave blank to disable
NEXUS_HEARTBEAT_ASSET_ADDRESS=
# Free if >= 10 seconds between updates
HEARTBEAT_MIN_INTERVAL_SEC=60
## Optional heartbeat waterline fields (used by pollers to bound reprocessing)
HEARTBEAT_WATERLINE_ENABLED=true
HEARTBEAT_WATERLINE_SOLANA_FIELD=last_safe_timestamp_solana
HEARTBEAT_WATERLINE_NEXUS_FIELD=last_safe_timestamp_usdd
HEARTBEAT_WATERLINE_SAFETY_SEC=120
